{
    "name": "top",
    "module" : "caf_core#caf_platform#platform_main",
    "description" : "Platform supervisor",
    "env" : {
        "appImage" : "process.env.APP_IMAGE||null",
        "appProtocol" : "process.env.APP_PROTOCOL||http",
        "appPublisher" :"process.env.APP_PUBLISHER||root",
        "appLocalName" : "process.env.APP_LOCAL_NAME||dcinabox",
        "appSuffix" : "process.env.APP_SUFFIX||vcap.me",
        "httpExternalPort" : "process.env.HTTP_EXTERNAL_PORT||80",
        "cmdArray" : "process.env.CMD_ARRAY||[]",
        "synchronousInit" : "process.env.SYNCHRONOUS_INIT||true",
        "maxRetries" : "process.env.MAX_RETRIES||10",
        "retryDelay" : "process.env.RETRY_DELAY||2000",
        "interval": "process.env.INTERVAL||5000",
        "longInterval": "process.env.LONG_INTERVAL||10000",
        "dieDelay": "process.env.DIE_DELAY||-1",
        "maxHangRetries":  "process.env.MAX_HANG_RETRIES||200",
        "netName" : "process.env.NET_NAME||vcap.me",
        "redisExternalPort" : "process.env.REDIS_EXTERNAL_PORT||6380",
        "redisPort" : "6379",
        "redisHost" : "process.env.REDIS_HOST||root-redis",
        "redisVolume" : "process.env.REDIS_VOLUME||/tmp/redis",
        "hostIp" : "process.env.HOST_IP||127.0.0.1",
        "accountsURL" : "process.env.ACCOUNTS_URL||http://root-accounts.vcap.me:3000",
        "iotDeviceManagerAppURL":"process.env.IOT_DEVICE_MANAGER_APP_URL||http://root-gadget.vcap.me:3000",
        "appWorkingDir" : "process.env.APP_WORKING_DIR||/usr/src/app",
        "hostVolume" : "process.env.HOST_VOLUME||/tmp/application",
        "appVolume" : "process.env.APP_VOLUME||/usr/src/app2",
        "containerNameSuffix" : "process.env.CONTAINER_NAME_SUFFIX||",
        "registryUsername" : "process.env.REGISTRY_USERNAME||foo",
        "registryPassword" : "process.env.REGISTRY_PASSWORD||pleasechange"
    },
    "components": [
        {
            "name": "log",
            "module": "caf_core#caf_components#plug_log",
            "description": "Logger service",
            "env" : {
                "logLevel" : "DEBUG"
            }
        },
        {
            "name": "docker",
            "module": "./plug_docker",
            "description": "Plug to access the local Docker daemon\n Properties: \n",
            "env": {
                "dockerSocket" : "process.env.DOCKER_SOCKET||/var/run/docker.sock"
            }
        },
        {
            "name": "network",
            "module": "./plug_network",
            "description": "Plug that creates a Docker network.\n Properties: \n",
            "env": {
                "netName" : "$._.env.netName",
                "alreadyCreated" : false
            }
        },
        {
            "name": "root-redis",
            "module": "./plug_container",
            "description": "Plug that creates a Redis container.\n Properties: \n",
            "env": {
                "image" : "redis:latest",
                "hostname" : "$._.env.redisHost",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" : "$._.env.redisExternalPort",
                        "containerPort" : "$._.env.redisPort"
                    }
                ],
                "volumes" : [
                    {
                        "source" : "$._.env.redisVolume",
                        "destination" : "/data"
                    }
                ],
                "networks": ["network"],
                "privileged" : false,
                "cmdArray" : ["redis-server", "--appendonly", "yes"]
            }
        },
        {
            "name": "root-accounts",
            "module": "./plug_container",
            "description": "Plug that creates the accounts service.\n Properties: \n",
            "env": {
                "image" : "registry.cafjs.com:32000/root-accounts",
                "hostname" : "root-accounts",
                "registryUsername" : "$._.env.registryUsername",
                "registryPassword" : "$._.env.registryPassword",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" : 3000,
                        "containerPort" : 3000
                    }
                ],
                "services" : [ "root-redis"],
                "privileged" : false,
                "cmdArray" : "$._.env.cmdArray",
                "networks": ["network"],
                "props" : {
                    "TRUSTED_PUB_KEY_FILE" : "rsa_pub.pem.dummy",
                    "PUBLIC_KEY_FILE" : "rsa_pub.pem.dummy",
                    "PRIVATE_KEY_FILE" : "rsa_priv.pem.dummy",
                    "HOST": "root-accounts",
                    "REDIS_PAAS" : "ignore",
                    "REDIS_PORT_6379_TCP_PORT" :  "$._.env.redisPort",
                    "REDIS_PORT_6379_TCP_ADDR" : "$._.env.redisHost",
                    "APP_LOCAL_NAME" : "accounts",
                    "APP_PROTOCOL" : "$._.env.appProtocol",
                    "APP_PUBLISHER" : "$._.env.appPublisher",
                    "APP_SUFFIX" :"$._.env.appSuffix"
                }
            }
        },
        {
            "name": "root-launcher",
            "module": "./plug_container",
            "description": "Plug that creates the launcher service.\n Properties: \n",
            "env": {
                "image" : "registry.cafjs.com:32000/root-launcher",
                "hostname" : "root-launcher",
                "registryUsername" : "$._.env.registryUsername",
                "registryPassword" : "$._.env.registryPassword",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" : 3001,
                        "containerPort" : 3000
                    }
                ],
                "services" : [ "root-redis"],
                "privileged" : false,
                "cmdArray" : "$._.env.cmdArray",
                "networks": ["network"],
                "props" : {
                    "TRUSTED_PUB_KEY_FILE" : "rsa_pub.pem.dummy",
                    "HOST": "root-launcher",
                    "REDIS_PAAS" : "ignore",
                    "REDIS_PORT_6379_TCP_PORT" :  "$._.env.redisPort",
                    "REDIS_PORT_6379_TCP_ADDR" : "$._.env.redisHost",
                    "APP_LOCAL_NAME" : "launcher",
                    "APP_PROTOCOL" : "$._.env.appProtocol",
                    "APP_PUBLISHER" : "$._.env.appPublisher",
                    "APP_SUFFIX" :"$._.env.appSuffix",
                    "ACCOUNTS_URL" : "$._.env.accountsURL"
                }
            }
        },
        {
            "name": "root-gadget",
            "module": "./plug_container",
            "description": "Plug that creates the gadget service.\n Properties: \n",
            "env": {
                "image" : "registry.cafjs.com:32000/root-gadget:latest",
                "hostname" : "root-gadget",
                "registryUsername" : "$._.env.registryUsername",
                "registryPassword" : "$._.env.registryPassword",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" : 3012,
                        "containerPort" : 3000
                    }
                ],
                "cmdArray" : "$._.env.cmdArray",
                "services" : [ "root-redis"],
                "privileged" : false,
                "networks": ["network"],
                "props" : {
                    "TRUSTED_PUB_KEY_FILE" : "rsa_pub.pem.dummy",
                    "HOST": "root-gadget",
                    "REDIS_PAAS" : "ignore",
                    "REDIS_PORT_6379_TCP_PORT" :  "$._.env.redisPort",
                    "REDIS_PORT_6379_TCP_ADDR" : "$._.env.redisHost",
                    "APP_LOCAL_NAME" : "gadget",
                    "APP_PROTOCOL" : "$._.env.appProtocol",
                    "APP_PUBLISHER" : "$._.env.appPublisher",
                    "APP_SUFFIX" :"$._.env.appSuffix",
                    "ACCOUNTS_URL" : "$._.env.accountsURL"
                }
            }
        },
        {
            "name": "root-application",
            "module": "./plug_container",
            "description": "Plug that creates the application.\n Properties: \n",
            "env": {
                "image" : "$._.env.appImage",
                "hostname" : "root-application",
                "registryUsername" : "$._.env.registryUsername",
                "registryPassword" : "$._.env.registryPassword",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" : 3003,
                        "containerPort" : 3000
                    }
                ],
                "volumes" : [
                    {
                        "source" : "$._.env.hostVolume",
                        "destination" : "$._.env.appVolume"
                    }
                ],
                "services" : [ "root-redis"],
                "cmdArray" : "$._.env.cmdArray",
                "privileged" : false,
                "networks": ["network"],
                "workingDir" : "$._.env.appWorkingDir",
                "props" : {
                    "APP_LOCAL_NAME" : "$._.env.appLocalName",
                    "TRUSTED_PUB_KEY_FILE" : "rsa_pub.pem.dummy",
                    "HOST": "root-application",
                    "REDIS_PAAS" : "ignore",
                    "REDIS_PORT_6379_TCP_PORT" :  "$._.env.redisPort",
                    "REDIS_PORT_6379_TCP_ADDR" : "$._.env.redisHost",
                    "APP_PROTOCOL" : "$._.env.appProtocol",
                    "APP_PUBLISHER" : "$._.env.appPublisher",
                    "APP_SUFFIX" :"$._.env.appSuffix",
                    "ACCOUNTS_URL" : "$._.env.accountsURL",
                    "IOT_DEVICE_MANAGER_APP_URL" : "$._.env.iotDeviceManagerAppURL"
                }
            }
        },
        {
            "name": "root-netproxy",
            "module": "./plug_container",
            "description": "Plug that creates an http proxy.\n Properties: \n",
            "env": {
                "image" : "registry.cafjs.com:32000/root-netproxy:latest",
                "hostname" : "root-netproxy",
                "registryUsername" : "$._.env.registryUsername",
                "registryPassword" : "$._.env.registryPassword",
                "containerNameSuffix" : "$._.env.containerNameSuffix",
                "ports" : [
                    {
                        "hostIp" : "$._.env.hostIp",
                        "hostPort" :"$._.env.httpExternalPort",
                        "containerPort" : 80
                    }
                ],
                "services" : [ "root-redis"],
                "privileged" : true,
                "cmdArray" : "$._.env.cmdArray",
                "networks": ["network"],
                "props" : {
                    "PROXY_JSON" : "proxy-local-nossl.json",
                    "HOST": "root-netproxy",
                    "REDIS_PAAS" : "ignore",
                    "REDIS_PORT_6379_TCP_PORT" :  "$._.env.redisPort",
                    "REDIS_PORT_6379_TCP_ADDR" : "$._.env.redisHost",
                    "APP_LOCAL_NAME" : "netproxy",
                    "APP_PROTOCOL" : "$._.env.appProtocol",
                    "APP_PUBLISHER" : "$._.env.appPublisher",
                    "APP_SUFFIX" :"$._.env.appSuffix"
                }
            }
        }
    ]
}
